#***************************************************
#***************************************************
##USERS USERS USERS USERS USERS USERS USERS USERS
#***************************************************
#***************************************************

get '/' do
  # Look in app/views/index.erb
  erb :index
end


#-----------------------
get '/sign_up' do
	erb :sign_up
end

post '/sign_up' do
	@user = User.create(params[:user])
	if @user.valid?
		session[:user_id] = @user.id
		session[:user_name] = @user.name
		redirect to '/homepage'
	else
		erb :homepage
	end
end
#-----------------------


get '/sign_in' do

	erb :sign_in
end

post '/sign_in' do
<<<<<<< HEAD
	@user = User.where(name: params[:user_name]).first
	if @user.authenticate(params[:user_name][:password])
=======
	@user = User.where(user_name: params[:user_name]).first
	if @user.authenticate(params[:password])
>>>>>>> a2e7eea6bede6c5ed15be96ca78f7dd7e70fae02
		session[:user_id] = @user.id
		session[:user_name] = @user.name
		redirect to '/homepage'
	else
		@error_message = "Uh oh, buddy, looks like you've gotta get your shit together.  Try again."
		erb :sign_in
	end
end

#-----------------------

get '/homepage' do
	@user = User.find(session[:user_id])
	@user_surveys = UserSurvey.all(session[:survey][:user_id])
	erb :homepage
end

#-----------------------

get 'view_profile' do
	@user = User.find(session[:user_id])
	erb :view_profile
end


post 'view_profile' do
	erb :view_profile
end

#-----------------------


get '/create_survey' do
	erb :create_survey
end

post '/create_survey' do
	erb :create_survey
end
#-----------------------



get '/logout' do
	session.clear
	redirect '/'
end

#******************************************************
#******************************************************
##SURVEYS SURVEYS SURVEYS SURVEYS SURVEYS SURVEYS 
#******************************************************
#******************************************************

get '/browse_all' do
	@surveys = Survey.all

	erb :browse_all
end

post '/browse_all' do
	erb :browse_all
end
#-----------------------

get '/view_survey' do
	@survey = Survey.find(params[:survey][:id])
	if @survey.user_id == sessions[:user_id]
		erb :view_survey
	else
		erb :take_survey
	end
end

#-----------------------

get '/take_survey' do
	@survey = Survey.find(params[:survey][:id])
	erb :take_survey
end

#-----------------------

get '/edit_survey' do
	@survey = Survey.find(params[:survey][:id])
	erb :edit_survey
end

post '/edit_survey' do
	@survey = Survey.find(params[:survey][:id])
	@survey.title = params[:survey][:title]
  @survey.question = params[:survey][:question]
  @survey.response = params[:survey][:response]
  if survey.update
	  redirect to '/homepage'
	end
end
